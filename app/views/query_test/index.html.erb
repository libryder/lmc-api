
<style type="text/css">
  .methods { display: none; }
  label { display: inline-block; width: 150px; }
  #method_name { margin: 0 0 15px 0 }
  #criteria_summary { display: none; }
  #meta, #loading { display: none; }
  #finalize { display: none; }
  .output { padding: 8px; margin: 20px 0 0 0; border: 1px solid #aaa8a8; background: #eee; color: #222}
    .output .status { padding: 10px; font-size: 15pt; font-weight: bold; display: inline-block; }
    .output .message { padding: 10px; display: inline-block; }
    .output strong { display: inline-block; width: 100px; }
  #url { overflow: scroll; white-space: nowrap}
</style>


<script type="text/javascript">
//<![CDATA[
  // Return a newly constructed div generated by the criteria object to be inserted into the method div
  function construct_criteria(crit) {
    div = $("<div></div>");
    label = $("<label></label>");
    input = $("<input>");
    
    label.text(crit+"");
    label.attr('for', crit);
    
    input.attr("type", "text");
    input.attr("id", crit);
    input.attr("name", 'criteria['+crit+']')
    
    div.append(label);
    div.append(input);
    return div
  }
  
  // Set all parameters for each method
  criteria = new Object();
  criteria.insertCall = ["calldate", "ouid", "external_id", "caller_id", "tracking_number", "ringto_number", "is_outbound", "assign_to", "external_id"];
  criteria.uploadAudio = [];
  criteria.insertUser = ["email", "first_name", "last_name", "ouid", "group_id", "external_id", "external_ouid"];
  criteria.insertGroup = ["parent_ouid", "name", "address_line_1", "address_line_2", "state", "zip", "external_id"];
  criteria.insertComment = ["user_id", "external_user_id", "call_detail_id", "external_call_detail_id", "is_public", "comment"];
  criteria.insertTag = ["user_id", "external_user_id", "call_detail_id", "external_call_detail_id", "is_public", "tag"];
  criteria.updateCallDetail = ["external_id", "calldate", "ouid", "external_ouid", "caller_id", "tracking_number", "ringto_number", "call_type", "assign_to"];
  criteria.updateUser = ["external_id", "email", "first_name", "last_name", "ouid", "external_ouid"];
  criteria.updateGroup = ["external_id", "name", "address_line_1", "address_line_2", "state", "zip"];
  criteria.getCallDetails = ["id", "external_id", "ouid", "external_ouid", "tracking_number", "ringto_number", "calldate", "call_detail_id"];
  criteria.getGroups = ["ouid", "external_ouid", "name", "state", "zip", "group_id"];
  criteria.getSubscriptionInfo = [];
  criteria.getUsers = ["email", "first_name", "last_name", "group_id", "ouid", "external_ouid", "user_id"];
  criteria.deleteRecord = ["type", "id", "ouid"];
  
  $(document).ready(function() {
    
    // When method is selected, generate a criteria div and #fadein relevant div's
    $('#method_name').change(function() {
      
      method = $(this).val();
      elem = $('#'+method);

      if (method == "null") {
        return false;
      }
      else {
        $('.criteria').fadeOut(0);
        crit_elem = elem.find('.criteria');
        crit_elem.html('');
        
        criteria_array = eval("criteria."+$(this).val());
        $('#sort_by option').remove();
        $.each(criteria_array, function(index, text) {
          crit_elem.append(construct_criteria(this));
          option = $('<option></option>').val(text).html(text);
          $('#sort_by').append(option);
        });
        
        elem.fadeIn('fast');
        $('#meta').fadeIn('fast');
        $('#criteria_summary').fadeIn('fast');
        $('#finalize').fadeIn('fast');
      }
    });
    
    // FORM SUBMIT
    $('form').submit(function() {
      $('#loading').show();
      form_data = $("#query-test :input[value!='']").serialize();
      generated_url = "https://api.logmycalls.com/services/"+method+"?"+form_data;
      
      $('#url').html(generated_url);
      
      $.getJSON('/services/'+method, form_data, function(data) {
        if (data.status == "error") {
          $('.output .status').css("color", "red");
          $('.output .message').text(data.error_message)
        }
        else {
          $('.output .status').css("color", "green");
          $('.output .message').text(JSON.stringify(data, null, 2));
        }
        $('.output .status').text(data.status);
        $('#loading').hide();
      });
      return false;
    });
    
  }); 
//]]>
</script>
<h2><span>Test</span> Query</h2>
<p>Use this form to test queries against the API without actually making changes to the databse. Alternatively, "dry_run" is an accepted meta parameter in any methods that make chanages to data.</p>
<p>You can use this service to visually test API calls or to generate form-encoded URL's to use as webhooks.


<form action="" method="post" id="query-test">
  <div> 
    Method: <select id="method_name">
      <option value="null">Select method</option>
      <option value="insertCall">insertCall</option>
      <option value="uploadAudio">uploadAudio</option>
      <option value="insertUser">insertUser</option>
      <option value="insertGroup">insertGroup</option>
      <option value="insertComment">insertComment</option>
      <option value="insertTag">insertTag</option>
      <option value="updateCallDetail">updateCallDetail</option>
      <option value="updateUser">updateUser</option>
      <option value="updateGroup">updateGroup</option>
      <option value="getCallDetails">getCallDetails</option>
      <option value="getGroups">getGroups</option>
      <option value="getSubscriptionInfo">getSubscriptionInfo</option>
      <option value="getUsers">getUsers</option>
      <option value="deleteRecord">deleteRecord</option>
    </select>
    
    <div id="criteria_summary">
      <h3>Criteria</h3>
      Enter any data you wish to post to the API. All criteria parameters affects the actual value of database objects. 
    </div><br />
    
    <div class="methods" id="insertCall">
      <div class="criteria"></div>
    </div>
    
    <div class="methods" id="uploadAudio">
      <div class="criteria"></div>
    </div>
    
    <div class="methods" id="insertUser">
      <div class="criteria"></div>
    </div>
    
    <div class="methods" id="insertGroup">
      <div class="criteria"></div>
    </div>
    
    <div class="methods" id="insertComment">
      <div class="criteria"></div>
    </div>
    
    <div class="methods" id="insertTag">
      <div class="criteria"></div>
    </div>
    
    <div class="methods" id="updateCallDetail">
      <div class="criteria"></div>
    </div>
    
    <div class="methods" id="updateUser">
      <div class="criteria"></div>
    </div>
    
    <div class="methods" id="updateGroup">
      <div class="criteria"></div>
    </div>
    
    <div class="methods" id="getCallDetails">
      <div class="criteria"></div>
    </div>
    
    <div class="methods" id="getGroups">
      <div class="criteria"></div>
    </div>
    
    <div class="methods" id="getSubscriptionInfo">
      <div class="criteria"></div>
    </div>
    
    <div class="methods" id="getUsers">
      <div class="criteria"></div>
    </div>
    
    <div class="methods" id="deleteRecord">
      <div class="criteria"></div>
    </div>
    
    <div id="meta">
      <h3>Meta</h3>
      <p>Enter any relevant meta data to be posted to the API.</p>
      <label for="id">id</label><input type="text" name="id" id="id" /><br />
      <label for="external_id">external_id</label><input type="text" name="external_id" id="external_id" /><br />
      <label for="api_key">api_key</label><input type="text" value="<%=@api_key%>" name="api_key" id="api_key" /><br />
      <label for="api_secret">api_secret</label><input type="text" value="<%=@api_secret%>" name="api_secret" id="api_secret" /><br />
      <input type="hidden" id="dry_run" name="dry_run" value="true" />
      <label for="start">start</label><input type="text" name="start" id="start" /><br />
      <label for="limit">limit</label><input type="text" name="limit" id="limit" /><br />
      <label for="sort_by">sort_by</label><select id="sort_by" name="sort_by"></select><br />
      <label for="sort_order">sort_order</label><select name="sort_order" id="sort_order"><option value="asc">asc</option><option value="desc">desc</option></select><br />
    </div>
    <br />
    
    <div id="finalize">
      <input type="submit" id="submit" value="Execute">
      <div id="loading"><img src="/images/ajax-loader-green.gif" alt="loading…" /></div>
    </div>

    <h3>Output:</h3>
    <div class="output">
      <strong>Status:</strong><div class="status">…</div><br />
      <strong>Message:</strong><div class="message">…</div>
    </div>
    
    <br />
    <h3>Form-encoded URL:</h3>
    <div class="output" id="url"></div>

  </div>

</form>